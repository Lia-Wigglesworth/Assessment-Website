(self.webpackChunkep_web=self.webpackChunkep_web||[]).push([["../libs/wp/prosemirror-transform/prosemirror-transform"],{"./node_modules/prosemirror-transform/dist/index.es.js":function(t,e,r){"use strict";r.r(e),r.d(e,{AddMarkStep:function(){return m},MapResult:function(){return i},Mapping:function(){return a},RemoveMarkStep:function(){return v},ReplaceAroundStep:function(){return d},ReplaceStep:function(){return u},Step:function(){return f},StepMap:function(){return p},StepResult:function(){return l},Transform:function(){return s},TransformError:function(){return TransformError},canJoin:function(){return canJoin},canSplit:function(){return canSplit},dropPoint:function(){return dropPoint},findWrapping:function(){return findWrapping},insertPoint:function(){return insertPoint},joinPoint:function(){return joinPoint},liftTarget:function(){return liftTarget},replaceStep:function(){return replaceStep}});var n=r("./node_modules/prosemirror-model/dist/index.es.js"),o=Math.pow(2,16);function recoverIndex(t){return 65535&t}var i=function MapResult(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=null),this.pos=t,this.deleted=e,this.recover=r},p=function StepMap(t,e){void 0===e&&(e=!1),this.ranges=t,this.inverted=e};p.prototype.recover=function recover(t){var e=0,r=recoverIndex(t);if(!this.inverted)for(var n=0;n<r;n++)e+=this.ranges[3*n+2]-this.ranges[3*n+1];return this.ranges[3*r]+e+function recoverOffset(t){return(t-(65535&t))/o}(t)},p.prototype.mapResult=function mapResult(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},p.prototype.map=function map(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},p.prototype._map=function _map(t,e,r){for(var n=0,p=this.inverted?2:1,a=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var c=this.ranges[s]-(this.inverted?n:0);if(c>t)break;var h=this.ranges[s+p],f=this.ranges[s+a],l=c+h;if(t<=l){var u=c+n+((h?t==c?-1:t==l?1:e:e)<0?0:f);if(r)return u;var d=s/3+(t-c)*o;return new i(u,e<0?t!=c:t!=l,d)}n+=f-h}return r?t+n:new i(t+n)},p.prototype.touches=function touches(t,e){for(var r=0,n=recoverIndex(e),o=this.inverted?2:1,i=this.inverted?1:2,p=0;p<this.ranges.length;p+=3){var a=this.ranges[p]-(this.inverted?r:0);if(a>t)break;var s=this.ranges[p+o];if(t<=a+s&&p==3*n)return!0;r+=this.ranges[p+i]-s}return!1},p.prototype.forEach=function forEach(t){for(var e=this.inverted?2:1,r=this.inverted?1:2,n=0,o=0;n<this.ranges.length;n+=3){var i=this.ranges[n],p=i-(this.inverted?o:0),a=i+(this.inverted?0:o),s=this.ranges[n+e],c=this.ranges[n+r];t(p,p+s,a,a+c),o+=c-s}},p.prototype.invert=function invert(){return new p(this.ranges,!this.inverted)},p.prototype.toString=function toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},p.offset=function offset(t){return 0==t?p.empty:new p(t<0?[0,-t,0]:[0,0,t])},p.empty=new p([]);var a=function Mapping(t,e,r,n){this.maps=t||[],this.from=r||0,this.to=null==n?this.maps.length:n,this.mirror=e};function TransformError(t){var e=Error.call(this,t);return e.__proto__=TransformError.prototype,e}a.prototype.slice=function slice(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.maps.length),new a(this.maps,this.mirror,t,e)},a.prototype.copy=function copy(){return new a(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},a.prototype.appendMap=function appendMap(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)},a.prototype.appendMapping=function appendMapping(t){for(var e=0,r=this.maps.length;e<t.maps.length;e++){var n=t.getMirror(e);this.appendMap(t.maps[e],null!=n&&n<e?r+n:null)}},a.prototype.getMirror=function getMirror(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},a.prototype.setMirror=function setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},a.prototype.appendMappingInverted=function appendMappingInverted(t){for(var e=t.maps.length-1,r=this.maps.length+t.maps.length;e>=0;e--){var n=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=n&&n>e?r-n-1:null)}},a.prototype.invert=function invert(){var t=new a;return t.appendMappingInverted(this),t},a.prototype.map=function map(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var r=this.from;r<this.to;r++)t=this.maps[r].map(t,e);return t},a.prototype.mapResult=function mapResult(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},a.prototype._map=function _map(t,e,r){for(var n=!1,o=null,p=this.from;p<this.to;p++){var a=this.maps[p],s=o&&o[p];if(null!=s&&a.touches(t,s))t=a.recover(s);else{var c=a.mapResult(t,e);if(null!=c.recover){var h=this.getMirror(p);if(null!=h&&h>p&&h<this.to){if(c.deleted){p=h,t=this.maps[h].recover(c.recover);continue}(o||(o=Object.create(null)))[h]=c.recover}}c.deleted&&(n=!0),t=c.pos}}return r?t:new i(t,n)},TransformError.prototype=Object.create(Error.prototype),TransformError.prototype.constructor=TransformError,TransformError.prototype.name="TransformError";var s=function Transform(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new a},c={before:{configurable:!0},docChanged:{configurable:!0}};function mustOverride(){throw new Error("Override me")}c.before.get=function(){return this.docs.length?this.docs[0]:this.doc},s.prototype.step=function step(t){var e=this.maybeStep(t);if(e.failed)throw new TransformError(e.failed);return this},s.prototype.maybeStep=function maybeStep(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},c.docChanged.get=function(){return this.steps.length>0},s.prototype.addStep=function addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},Object.defineProperties(s.prototype,c);var h=Object.create(null),f=function Step(){};f.prototype.apply=function apply(t){return mustOverride()},f.prototype.getMap=function getMap(){return p.empty},f.prototype.invert=function invert(t){return mustOverride()},f.prototype.map=function map(t){return mustOverride()},f.prototype.merge=function merge(t){return null},f.prototype.toJSON=function toJSON(){return mustOverride()},f.fromJSON=function fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var r=h[e.stepType];if(!r)throw new RangeError("No step type "+e.stepType+" defined");return r.fromJSON(t,e)},f.jsonID=function jsonID(t,e){if(t in h)throw new RangeError("Duplicate use of step JSON ID "+t);return h[t]=e,e.prototype.jsonID=t,e};var l=function StepResult(t,e){this.doc=t,this.failed=e};l.ok=function ok(t){return new l(t,null)},l.fail=function fail(t){return new l(null,t)},l.fromReplace=function fromReplace(t,e,r,o){try{return l.ok(t.replace(e,r,o))}catch(t){if(t instanceof n.ReplaceError)return l.fail(t.message);throw t}};var u=function(t){function ReplaceStep(e,r,n,o){t.call(this),this.from=e,this.to=r,this.slice=n,this.structure=!!o}return t&&(ReplaceStep.__proto__=t),ReplaceStep.prototype=Object.create(t&&t.prototype),ReplaceStep.prototype.constructor=ReplaceStep,ReplaceStep.prototype.apply=function apply(t){return this.structure&&contentBetween(t,this.from,this.to)?l.fail("Structure replace would overwrite content"):l.fromReplace(t,this.from,this.to,this.slice)},ReplaceStep.prototype.getMap=function getMap(){return new p([this.from,this.to-this.from,this.slice.size])},ReplaceStep.prototype.invert=function invert(t){return new ReplaceStep(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},ReplaceStep.prototype.map=function map(t){var e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted?null:new ReplaceStep(e.pos,Math.max(e.pos,r.pos),this.slice)},ReplaceStep.prototype.merge=function merge(t){if(!(t instanceof ReplaceStep)||t.structure!=this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var e=this.slice.size+t.slice.size==0?n.Slice.empty:new n.Slice(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new ReplaceStep(t.from,this.to,e,this.structure)}var r=this.slice.size+t.slice.size==0?n.Slice.empty:new n.Slice(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new ReplaceStep(this.from,this.to+(t.to-t.from),r,this.structure)},ReplaceStep.prototype.toJSON=function toJSON(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},ReplaceStep.fromJSON=function fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ReplaceStep(e.from,e.to,n.Slice.fromJSON(t,e.slice),!!e.structure)},ReplaceStep}(f);f.jsonID("replace",u);var d=function(t){function ReplaceAroundStep(e,r,n,o,i,p,a){t.call(this),this.from=e,this.to=r,this.gapFrom=n,this.gapTo=o,this.slice=i,this.insert=p,this.structure=!!a}return t&&(ReplaceAroundStep.__proto__=t),ReplaceAroundStep.prototype=Object.create(t&&t.prototype),ReplaceAroundStep.prototype.constructor=ReplaceAroundStep,ReplaceAroundStep.prototype.apply=function apply(t){if(this.structure&&(contentBetween(t,this.from,this.gapFrom)||contentBetween(t,this.gapTo,this.to)))return l.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return l.fail("Gap is not a flat range");var r=this.slice.insertAt(this.insert,e.content);return r?l.fromReplace(t,this.from,this.to,r):l.fail("Content does not fit in gap")},ReplaceAroundStep.prototype.getMap=function getMap(){return new p([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},ReplaceAroundStep.prototype.invert=function invert(t){var e=this.gapTo-this.gapFrom;return new ReplaceAroundStep(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},ReplaceAroundStep.prototype.map=function map(t){var e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),n=t.map(this.gapFrom,-1),o=t.map(this.gapTo,1);return e.deleted&&r.deleted||n<e.pos||o>r.pos?null:new ReplaceAroundStep(e.pos,r.pos,n,o,this.slice,this.insert,this.structure)},ReplaceAroundStep.prototype.toJSON=function toJSON(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},ReplaceAroundStep.fromJSON=function fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to||"number"!=typeof e.gapFrom||"number"!=typeof e.gapTo||"number"!=typeof e.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ReplaceAroundStep(e.from,e.to,e.gapFrom,e.gapTo,n.Slice.fromJSON(t,e.slice),e.insert,!!e.structure)},ReplaceAroundStep}(f);function contentBetween(t,e,r){for(var n=t.resolve(e),o=r-e,i=n.depth;o>0&&i>0&&n.indexAfter(i)==n.node(i).childCount;)i--,o--;if(o>0)for(var p=n.node(i).maybeChild(n.indexAfter(i));o>0;){if(!p||p.isLeaf)return!0;p=p.firstChild,o--}return!1}function canCut(t,e,r){return(0==e||t.canReplace(e,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function liftTarget(t){for(var e=t.parent.content.cutByIndex(t.startIndex,t.endIndex),r=t.depth;;--r){var n=t.$from.node(r),o=t.$from.index(r),i=t.$to.indexAfter(r);if(r<t.depth&&n.canReplace(o,i,e))return r;if(0==r||n.type.spec.isolating||!canCut(n,o,i))break}}function findWrapping(t,e,r,n){void 0===n&&(n=t);var o=function findWrappingOutside(t,e){var r=t.parent,n=t.startIndex,o=t.endIndex,i=r.contentMatchAt(n).findWrapping(e);if(!i)return null;var p=i.length?i[0]:e;return r.canReplaceWith(n,o,p)?i:null}(t,e),i=o&&function findWrappingInside(t,e){var r=t.parent,n=t.startIndex,o=t.endIndex,i=r.child(n),p=e.contentMatch.findWrapping(i.type);if(!p)return null;for(var a=(p.length?p[p.length-1]:e).contentMatch,s=n;a&&s<o;s++)a=a.matchType(r.child(s).type);if(!a||!a.validEnd)return null;return p}(n,e);return i?o.map(withAttrs).concat({type:e,attrs:r}).concat(i.map(withAttrs)):null}function withAttrs(t){return{type:t,attrs:null}}function canSplit(t,e,r,n){void 0===r&&(r=1);var o=t.resolve(e),i=o.depth-r,p=n&&n[n.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!p.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(var a=o.depth-1,s=r-2;a>i;a--,s--){var c=o.node(a),h=o.index(a);if(c.type.spec.isolating)return!1;var f=c.content.cutByIndex(h,c.childCount),l=n&&n[s]||c;if(l!=c&&(f=f.replaceChild(0,l.type.create(l.attrs))),!c.canReplace(h+1,c.childCount)||!l.type.validContent(f))return!1}var u=o.indexAfter(i),d=n&&n[0];return o.node(i).canReplaceWith(u,u,d?d.type:o.node(i+1).type)}function canJoin(t,e){var r=t.resolve(e),n=r.index();return joinable(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function joinable(t,e){return t&&e&&!t.isLeaf&&t.canAppend(e)}function joinPoint(t,e,r){void 0===r&&(r=-1);for(var n=t.resolve(e),o=n.depth;;o--){var i=void 0,p=void 0,a=n.index(o);if(o==n.depth?(i=n.nodeBefore,p=n.nodeAfter):r>0?(i=n.node(o+1),a++,p=n.node(o).maybeChild(a)):(i=n.node(o).maybeChild(a-1),p=n.node(o+1)),i&&!i.isTextblock&&joinable(i,p)&&n.node(o).canReplace(a,a+1))return e;if(0==o)break;e=r<0?n.before(o):n.after(o)}}function insertPoint(t,e,r){var n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),r))return e;if(0==n.parentOffset)for(var o=n.depth-1;o>=0;o--){var i=n.index(o);if(n.node(o).canReplaceWith(i,i,r))return n.before(o+1);if(i>0)return null}if(n.parentOffset==n.parent.content.size)for(var p=n.depth-1;p>=0;p--){var a=n.indexAfter(p);if(n.node(p).canReplaceWith(a,a,r))return n.after(p+1);if(a<n.node(p).childCount)return null}}function dropPoint(t,e,r){var n=t.resolve(e);if(!r.content.size)return e;for(var o=r.content,i=0;i<r.openStart;i++)o=o.firstChild.content;for(var p=1;p<=(0==r.openStart&&r.size?2:1);p++)for(var a=n.depth;a>=0;a--){var s=a==n.depth?0:n.pos<=(n.start(a+1)+n.end(a+1))/2?-1:1,c=n.index(a)+(s>0?1:0);if(1==p?n.node(a).canReplace(c,c,o):n.node(a).contentMatchAt(c).findWrapping(o.firstChild.type))return 0==s?n.pos:s<0?n.before(a+1):n.after(a+1)}return null}function mapFragment(t,e,r){for(var o=[],i=0;i<t.childCount;i++){var p=t.child(i);p.content.size&&(p=p.copy(mapFragment(p.content,e,p))),p.isInline&&(p=e(p,r,i)),o.push(p)}return n.Fragment.fromArray(o)}f.jsonID("replaceAround",d),s.prototype.lift=function(t,e){for(var r=t.$from,o=t.$to,i=t.depth,p=r.before(i+1),a=o.after(i+1),s=p,c=a,h=n.Fragment.empty,f=0,l=i,u=!1;l>e;l--)u||r.index(l)>0?(u=!0,h=n.Fragment.from(r.node(l).copy(h)),f++):s--;for(var m=n.Fragment.empty,v=0,y=i,g=!1;y>e;y--)g||o.after(y+1)<o.end(y)?(g=!0,m=n.Fragment.from(o.node(y).copy(m)),v++):c++;return this.step(new d(s,c,p,a,new n.Slice(h.append(m),f,v),h.size-f,!0))},s.prototype.wrap=function(t,e){for(var r=n.Fragment.empty,o=e.length-1;o>=0;o--)r=n.Fragment.from(e[o].type.create(e[o].attrs,r));var i=t.start,p=t.end;return this.step(new d(i,p,i,p,new n.Slice(r,0,0),e.length,!0))},s.prototype.setBlockType=function(t,e,r,o){var i=this;if(void 0===e&&(e=t),!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var p=this.steps.length;return this.doc.nodesBetween(t,e,(function(t,e){if(t.isTextblock&&!t.hasMarkup(r,o)&&function canChangeType(t,e,r){var n=t.resolve(e),o=n.index();return n.parent.canReplaceWith(o,o+1,r)}(i.doc,i.mapping.slice(p).map(e),r)){i.clearIncompatible(i.mapping.slice(p).map(e,1),r);var a=i.mapping.slice(p),s=a.map(e,1),c=a.map(e+t.nodeSize,1);return i.step(new d(s,c,s+1,c-1,new n.Slice(n.Fragment.from(r.create(o,null,t.marks)),0,0),1,!0)),!1}})),this},s.prototype.setNodeMarkup=function(t,e,r,o){var i=this.doc.nodeAt(t);if(!i)throw new RangeError("No node at given position");e||(e=i.type);var p=e.create(r,null,o||i.marks);if(i.isLeaf)return this.replaceWith(t,t+i.nodeSize,p);if(!e.validContent(i.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new d(t,t+i.nodeSize,t+1,t+i.nodeSize-1,new n.Slice(n.Fragment.from(p),0,0),1,!0))},s.prototype.split=function(t,e,r){void 0===e&&(e=1);for(var o=this.doc.resolve(t),i=n.Fragment.empty,p=n.Fragment.empty,a=o.depth,s=o.depth-e,c=e-1;a>s;a--,c--){i=n.Fragment.from(o.node(a).copy(i));var h=r&&r[c];p=n.Fragment.from(h?h.type.create(h.attrs,p):o.node(a).copy(p))}return this.step(new u(t,t,new n.Slice(i.append(p),e,e),!0))},s.prototype.join=function(t,e){void 0===e&&(e=1);var r=new u(t-e,t+e,n.Slice.empty,!0);return this.step(r)};var m=function(t){function AddMarkStep(e,r,n){t.call(this),this.from=e,this.to=r,this.mark=n}return t&&(AddMarkStep.__proto__=t),AddMarkStep.prototype=Object.create(t&&t.prototype),AddMarkStep.prototype.constructor=AddMarkStep,AddMarkStep.prototype.apply=function apply(t){var e=this,r=t.slice(this.from,this.to),o=t.resolve(this.from),i=o.node(o.sharedDepth(this.to)),p=new n.Slice(mapFragment(r.content,(function(t,r){return r.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t}),i),r.openStart,r.openEnd);return l.fromReplace(t,this.from,this.to,p)},AddMarkStep.prototype.invert=function invert(){return new v(this.from,this.to,this.mark)},AddMarkStep.prototype.map=function map(t){var e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted||e.pos>=r.pos?null:new AddMarkStep(e.pos,r.pos,this.mark)},AddMarkStep.prototype.merge=function merge(t){if(t instanceof AddMarkStep&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new AddMarkStep(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},AddMarkStep.prototype.toJSON=function toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},AddMarkStep.fromJSON=function fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new AddMarkStep(e.from,e.to,t.markFromJSON(e.mark))},AddMarkStep}(f);f.jsonID("addMark",m);var v=function(t){function RemoveMarkStep(e,r,n){t.call(this),this.from=e,this.to=r,this.mark=n}return t&&(RemoveMarkStep.__proto__=t),RemoveMarkStep.prototype=Object.create(t&&t.prototype),RemoveMarkStep.prototype.constructor=RemoveMarkStep,RemoveMarkStep.prototype.apply=function apply(t){var e=this,r=t.slice(this.from,this.to),o=new n.Slice(mapFragment(r.content,(function(t){return t.mark(e.mark.removeFromSet(t.marks))})),r.openStart,r.openEnd);return l.fromReplace(t,this.from,this.to,o)},RemoveMarkStep.prototype.invert=function invert(){return new m(this.from,this.to,this.mark)},RemoveMarkStep.prototype.map=function map(t){var e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted||e.pos>=r.pos?null:new RemoveMarkStep(e.pos,r.pos,this.mark)},RemoveMarkStep.prototype.merge=function merge(t){if(t instanceof RemoveMarkStep&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from)return new RemoveMarkStep(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark)},RemoveMarkStep.prototype.toJSON=function toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},RemoveMarkStep.fromJSON=function fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RemoveMarkStep(e.from,e.to,t.markFromJSON(e.mark))},RemoveMarkStep}(f);function replaceStep(t,e,r,o){if(void 0===r&&(r=e),void 0===o&&(o=n.Slice.empty),e==r&&!o.size)return null;var i=t.resolve(e),p=t.resolve(r);return fitsTrivially(i,p,o)?new u(e,r,o):new y(i,p,o).fit()}function fitsTrivially(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}f.jsonID("removeMark",v),s.prototype.addMark=function(t,e,r){var n=this,o=[],i=[],p=null,a=null;return this.doc.nodesBetween(t,e,(function(n,s,c){if(n.isInline){var h=n.marks;if(!r.isInSet(h)&&c.type.allowsMarkType(r.type)){for(var f=Math.max(s,t),l=Math.min(s+n.nodeSize,e),u=r.addToSet(h),d=0;d<h.length;d++)h[d].isInSet(u)||(p&&p.to==f&&p.mark.eq(h[d])?p.to=l:o.push(p=new v(f,l,h[d])));a&&a.to==f?a.to=l:i.push(a=new m(f,l,r))}}})),o.forEach((function(t){return n.step(t)})),i.forEach((function(t){return n.step(t)})),this},s.prototype.removeMark=function(t,e,r){var o=this;void 0===r&&(r=null);var i=[],p=0;return this.doc.nodesBetween(t,e,(function(o,a){if(o.isInline){p++;var s=null;if(r instanceof n.MarkType){var c=r.isInSet(o.marks);c&&(s=[c])}else r?r.isInSet(o.marks)&&(s=[r]):s=o.marks;if(s&&s.length)for(var h=Math.min(a+o.nodeSize,e),f=0;f<s.length;f++){for(var l=s[f],u=void 0,d=0;d<i.length;d++){var m=i[d];m.step==p-1&&l.eq(i[d].style)&&(u=m)}u?(u.to=h,u.step=p):i.push({style:l,from:Math.max(a,t),to:h,step:p})}}})),i.forEach((function(t){return o.step(new v(t.from,t.to,t.style))})),this},s.prototype.clearIncompatible=function(t,e,r){void 0===r&&(r=e.contentMatch);for(var o=this.doc.nodeAt(t),i=[],p=t+1,a=0;a<o.childCount;a++){var s=o.child(a),c=p+s.nodeSize,h=r.matchType(s.type,s.attrs);if(h){r=h;for(var f=0;f<s.marks.length;f++)e.allowsMarkType(s.marks[f].type)||this.step(new v(p,c,s.marks[f]))}else i.push(new u(p,c,n.Slice.empty));p=c}if(!r.validEnd){var l=r.fillBefore(n.Fragment.empty,!0);this.replace(p,p,new n.Slice(l,0,0))}for(var d=i.length-1;d>=0;d--)this.step(i[d]);return this},s.prototype.replace=function(t,e,r){void 0===e&&(e=t),void 0===r&&(r=n.Slice.empty);var o=replaceStep(this.doc,t,e,r);return o&&this.step(o),this},s.prototype.replaceWith=function(t,e,r){return this.replace(t,e,new n.Slice(n.Fragment.from(r),0,0))},s.prototype.delete=function(t,e){return this.replace(t,e,n.Slice.empty)},s.prototype.insert=function(t,e){return this.replaceWith(t,t,e)};var y=function Fitter(t,e,r){this.$to=e,this.$from=t,this.unplaced=r,this.frontier=[];for(var o=0;o<=t.depth;o++){var i=t.node(o);this.frontier.push({type:i.type,match:i.contentMatchAt(t.indexAfter(o))})}this.placed=n.Fragment.empty;for(var p=t.depth;p>0;p--)this.placed=n.Fragment.from(t.node(p).copy(this.placed))},g={depth:{configurable:!0}};function dropFromFragment(t,e,r){return 0==e?t.cutByIndex(r):t.replaceChild(0,t.firstChild.copy(dropFromFragment(t.firstChild.content,e-1,r)))}function addToFragment(t,e,r){return 0==e?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(addToFragment(t.lastChild.content,e-1,r)))}function contentAt(t,e){for(var r=0;r<e;r++)t=t.firstChild.content;return t}function closeNodeStart(t,e,r){if(e<=0)return t;var o=t.content;return e>1&&(o=o.replaceChild(0,closeNodeStart(o.firstChild,e-1,1==o.childCount?r-1:0))),e>0&&(o=t.type.contentMatch.fillBefore(o).append(o),r<=0&&(o=o.append(t.type.contentMatch.matchFragment(o).fillBefore(n.Fragment.empty,!0)))),t.copy(o)}function contentAfterFits(t,e,r,n,o){var i=t.node(e),p=o?t.indexAfter(e):t.index(e);if(p==i.childCount&&!r.compatibleContent(i.type))return null;var a=n.fillBefore(i.content,!0,p);return a&&!function invalidMarks(t,e,r){for(var n=r;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}(r,i.content,p)?a:null}function closeFragment(t,e,r,o,i){if(e<r){var p=t.firstChild;t=t.replaceChild(0,p.copy(closeFragment(p.content,e+1,r,o,p)))}if(e>o){var a=i.contentMatchAt(0),s=a.fillBefore(t).append(t);t=s.append(a.matchFragment(s).fillBefore(n.Fragment.empty,!0))}return t}function coveredDepths(t,e){for(var r=[],n=Math.min(t.depth,e.depth);n>=0;n--){var o=t.start(n);if(o<t.pos-(t.depth-n)||e.end(n)>e.pos+(e.depth-n)||t.node(n).type.spec.isolating||e.node(n).type.spec.isolating)break;o==e.start(n)&&r.push(n)}return r}g.depth.get=function(){return this.frontier.length-1},y.prototype.fit=function fit(){for(;this.unplaced.size;){var fit=this.findFittable();fit?this.placeNodes(fit):this.openMore()||this.dropNode()}var t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,r=this.$from,o=t<0?this.$to:r.doc.resolve(t);if(this.close(o)){for(var i=this.placed,p=r.depth,a=o.depth;p&&a&&1==i.childCount;)i=i.firstChild.content,p--,a--;var s=new n.Slice(i,p,a);if(t>-1)return new d(r.pos,t,this.$to.pos,this.$to.end(),s,e);if(s.size||r.pos!=this.$to.pos)return new u(r.pos,o.pos,s)}return null},y.prototype.findFittable=function findFittable(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--)for(var r=void 0,o=(e?(r=contentAt(this.unplaced.content,e-1).firstChild).content:this.unplaced.content).firstChild,i=this.depth;i>=0;i--){var p=this.frontier[i],a=p.type,s=p.match,c=void 0,h=void 0;if(1==t&&(o?s.matchType(o.type)||(h=s.fillBefore(n.Fragment.from(o),!1)):a.compatibleContent(r.type)))return{sliceDepth:e,frontierDepth:i,parent:r,inject:h};if(2==t&&o&&(c=s.findWrapping(o.type)))return{sliceDepth:e,frontierDepth:i,parent:r,wrap:c};if(r&&s.matchType(r.type))break}},y.prototype.openMore=function openMore(){var t=this.unplaced,e=t.content,r=t.openStart,o=t.openEnd,i=contentAt(e,r);return!(!i.childCount||i.firstChild.isLeaf)&&(this.unplaced=new n.Slice(e,r+1,Math.max(o,i.size+r>=e.size-o?r+1:0)),!0)},y.prototype.dropNode=function dropNode(){var t=this.unplaced,e=t.content,r=t.openStart,o=t.openEnd,i=contentAt(e,r);if(i.childCount<=1&&r>0){var p=e.size-r<=r+i.size;this.unplaced=new n.Slice(dropFromFragment(e,r-1,1),r-1,p?r-1:o)}else this.unplaced=new n.Slice(dropFromFragment(e,r,1),r,o)},y.prototype.placeNodes=function placeNodes(t){for(var e=t.sliceDepth,r=t.frontierDepth,o=t.parent,i=t.inject,p=t.wrap;this.depth>r;)this.closeFrontierNode();if(p)for(var a=0;a<p.length;a++)this.openFrontierNode(p[a]);var s=this.unplaced,c=o?o.content:s.content,h=s.openStart-e,f=0,l=[],u=this.frontier[r],d=u.match,m=u.type;if(i){for(var v=0;v<i.childCount;v++)l.push(i.child(v));d=d.matchFragment(i)}for(var y=c.size+e-(s.content.size-s.openEnd);f<c.childCount;){var g=c.child(f),S=d.matchType(g.type);if(!S)break;(++f>1||0==h||g.content.size)&&(d=S,l.push(closeNodeStart(g.mark(m.allowedMarks(g.marks)),1==f?h:0,f==c.childCount?y:-1)))}var w=f==c.childCount;w||(y=-1),w&&y<0&&o&&o.type==this.frontier[this.depth].type?this.closeFrontierNode():this.frontier[r].match=d;for(var k=0,M=c;k<y;k++){var R=M.lastChild;this.frontier.push({type:R.type,match:R.contentMatchAt(R.childCount)}),M=R.content}this.unplaced=w?0==e?n.Slice.empty:new n.Slice(dropFromFragment(s.content,e-1,1),e-1,y<0?s.openEnd:e-1):new n.Slice(dropFromFragment(s.content,e,f),s.openStart,s.openEnd),this.placed=addToFragment(this.placed,r,n.Fragment.from(l))},y.prototype.mustMoveInline=function mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;var t,e=this.frontier[this.depth];if(!e.type.isTextblock||!contentAfterFits(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;for(var r=this.$to.depth,n=this.$to.after(r);r>1&&n==this.$to.end(--r);)++n;return n},y.prototype.findCloseLevel=function findCloseLevel(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var r=this.frontier[e],n=r.match,o=contentAfterFits(t,e,r.type,n,!1);if(o){for(var i=e-1;i>=0;i--){var p=this.frontier[i],a=p.match,s=contentAfterFits(t,i,p.type,a,!0);if(!s||s.childCount)continue t}return{depth:e,fit:o}}}},y.prototype.close=function close(t){var close=this.findCloseLevel(t);if(!close)return!1;for(;this.depth>close.depth;)this.closeFrontierNode();close.fit.childCount&&(this.placed=addToFragment(this.placed,close.depth,close.fit));for(var e=close.depth+1;e<=t.depth;e++){var r=t.node(e),n=r.type.contentMatch.fillBefore(r.content,!0,t.index(e));this.openFrontierNode(r.type,r.attrs,n)}return!0},y.prototype.openFrontierNode=function openFrontierNode(t,e,r){var o=this.frontier[this.depth];o.match=o.match.matchType(t),this.placed=addToFragment(this.placed,this.depth,n.Fragment.from(t.create(e,r))),this.frontier.push({type:t,match:t.contentMatch})},y.prototype.closeFrontierNode=function closeFrontierNode(){var t=this.frontier.pop().match.fillBefore(n.Fragment.empty,!0);t.childCount&&(this.placed=addToFragment(this.placed,this.frontier.length,t))},Object.defineProperties(y.prototype,g),s.prototype.replaceRange=function(t,e,r){if(!r.size)return this.deleteRange(t,e);var o=this.doc.resolve(t),i=this.doc.resolve(e);if(fitsTrivially(o,i,r))return this.step(new u(t,e,r));var p=coveredDepths(o,this.doc.resolve(e));0==p[p.length-1]&&p.pop();var a=-(o.depth+1);p.unshift(a);for(var s=o.depth,c=o.pos-1;s>0;s--,c--){var h=o.node(s).type.spec;if(h.defining||h.isolating)break;p.indexOf(s)>-1?a=s:o.before(s)==c&&p.splice(1,0,-s)}for(var f=p.indexOf(a),l=[],d=r.openStart,m=r.content,v=0;;v++){var y=m.firstChild;if(l.push(y),v==r.openStart)break;m=y.content}d>0&&l[d-1].type.spec.defining&&o.node(f).type!=l[d-1].type?d-=1:d>=2&&l[d-1].isTextblock&&l[d-2].type.spec.defining&&o.node(f).type!=l[d-2].type&&(d-=2);for(var g=r.openStart;g>=0;g--){var S=(g+d+1)%(r.openStart+1),w=l[S];if(w)for(var k=0;k<p.length;k++){var M=p[(k+f)%p.length],R=!0;M<0&&(R=!1,M=-M);var F=o.node(M-1),b=o.index(M-1);if(F.canReplaceWith(b,b,w.type,w.marks))return this.replace(o.before(M),R?i.after(M):e,new n.Slice(closeFragment(r.content,0,r.openStart,S),S,r.openEnd))}}for(var A=this.steps.length,C=p.length-1;C>=0&&(this.replace(t,e,r),!(this.steps.length>A));C--){var T=p[C];C<0||(t=o.before(T),e=i.after(T))}return this},s.prototype.replaceRangeWith=function(t,e,r){if(!r.isInline&&t==e&&this.doc.resolve(t).parent.content.size){var o=insertPoint(this.doc,t,r.type);null!=o&&(t=e=o)}return this.replaceRange(t,e,new n.Slice(n.Fragment.from(r),0,0))},s.prototype.deleteRange=function(t,e){for(var r=this.doc.resolve(t),n=this.doc.resolve(e),o=coveredDepths(r,n),i=0;i<o.length;i++){var p=o[i],a=i==o.length-1;if(a&&0==p||r.node(p).type.contentMatch.validEnd)return this.delete(r.start(p),n.end(p));if(p>0&&(a||r.node(p-1).canReplace(r.index(p-1),n.indexAfter(p-1))))return this.delete(r.before(p),n.after(p))}for(var s=1;s<=r.depth&&s<=n.depth;s++)if(t-r.start(s)==r.depth-s&&e>r.end(s)&&n.end(s)-e!=n.depth-s)return this.delete(r.before(s),e);return this.delete(t,e)}}}]);