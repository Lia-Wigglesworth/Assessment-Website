(self.webpackChunkep_web=self.webpackChunkep_web||[]).push([["../libs/wp/prosemirror-history/prosemirror-history"],{"./node_modules/prosemirror-history/dist/index.es.js":function(e,t,n){"use strict";n.r(t),n.d(t,{HistoryState:function(){return p},closeHistory:function(){return closeHistory},history:function(){return history},redo:function(){return redo},redoDepth:function(){return redoDepth},undo:function(){return undo},undoDepth:function(){return undoDepth}});var r=n("./node_modules/rope-sequence/dist/index.es.js"),s=n("./node_modules/prosemirror-transform/dist/index.es.js"),i=n("./node_modules/prosemirror-state/dist/index.es.js"),o=function Branch(e,t){this.items=e,this.eventCount=t};o.prototype.popEvent=function popEvent(e,t){var n=this;if(0==this.eventCount)return null;for(var r,s,i=this.items.length;;i--){if(this.items.get(i-1).selection){--i;break}}t&&(r=this.remapping(i,this.items.length),s=r.maps.length);var p,u,m=e.tr,h=[],l=[];return this.items.forEach((function(e,t){if(!e.step)return r||(r=n.remapping(i,t+1),s=r.maps.length),s--,void l.push(e);if(r){l.push(new a(e.map));var c,f=e.step.map(r.slice(s));f&&m.maybeStep(f).doc&&(c=m.mapping.maps[m.mapping.maps.length-1],h.push(new a(c,null,null,h.length+l.length))),s--,c&&r.appendMap(c,s)}else m.maybeStep(e.step);return e.selection?(p=r?e.selection.map(r.slice(s)):e.selection,u=new o(n.items.slice(0,i).append(l.reverse().concat(h)),n.eventCount-1),!1):void 0}),this.items.length,0),{remaining:u,transform:m,selection:p}},o.prototype.addTransform=function addTransform(e,t,n,r){for(var s=[],i=this.eventCount,p=this.items,m=!r&&p.length?p.get(p.length-1):null,h=0;h<e.steps.length;h++){var l,c=e.steps[h].invert(e.docs[h]),f=new a(e.mapping.maps[h],c,t);(l=m&&m.merge(f))&&(f=l,h?s.pop():p=p.slice(0,p.length-1)),s.push(f),t&&(i++,t=null),r||(m=f)}var d=i-n.depth;return d>u&&(p=function cutOffEvents(e,t){var n;return e.forEach((function(e,r){if(e.selection&&0==t--)return n=r,!1})),e.slice(n)}(p,d),i-=d),new o(p.append(s),i)},o.prototype.remapping=function remapping(e,t){var n=new s.Mapping;return this.items.forEach((function(t,r){var s=null!=t.mirrorOffset&&r-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:null;n.appendMap(t.map,s)}),e,t),n},o.prototype.addMaps=function addMaps(e){return 0==this.eventCount?this:new o(this.items.append(e.map((function(e){return new a(e)}))),this.eventCount)},o.prototype.rebased=function rebased(e,t){if(!this.eventCount)return this;var n=[],r=Math.max(0,this.items.length-t),s=e.mapping,i=e.steps.length,p=this.eventCount;this.items.forEach((function(e){e.selection&&p--}),r);var u=t;this.items.forEach((function(t){var r=s.getMirror(--u);if(null!=r){i=Math.min(i,r);var o=s.maps[r];if(t.step){var m=e.steps[r].invert(e.docs[r]),h=t.selection&&t.selection.map(s.slice(u+1,r));h&&p++,n.push(new a(o,m,h))}else n.push(new a(o))}}),r);for(var m=[],h=t;h<i;h++)m.push(new a(s.maps[h]));var l=this.items.slice(0,r).append(m).append(n),c=new o(l,p);return c.emptyItemCount()>500&&(c=c.compress(this.items.length-n.length)),c},o.prototype.emptyItemCount=function emptyItemCount(){var e=0;return this.items.forEach((function(t){t.step||e++})),e},o.prototype.compress=function compress(e){void 0===e&&(e=this.items.length);var t=this.remapping(0,e),n=t.maps.length,s=[],i=0;return this.items.forEach((function(r,o){if(o>=e)s.push(r),r.selection&&i++;else if(r.step){var p=r.step.map(t.slice(n)),u=p&&p.getMap();if(n--,u&&t.appendMap(u,n),p){var m=r.selection&&r.selection.map(t.slice(n));m&&i++;var h,l=new a(u.invert(),p,m),c=s.length-1;(h=s.length&&s[c].merge(l))?s[c]=h:s.push(l)}}else r.map&&n--}),this.items.length,0),new o(r.Z.from(s.reverse()),i)},o.empty=new o(r.Z.empty,0);var a=function Item(e,t,n,r){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=r};a.prototype.merge=function merge(e){if(this.step&&e.step&&!e.selection){var t=e.step.merge(this.step);if(t)return new a(t.getMap().invert(),t,this.selection)}};var p=function HistoryState(e,t,n,r){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=r},u=20;function rangesFor(e){var t=[];return e.forEach((function(e,n,r,s){return t.push(r,s)})),t}function mapRanges(e,t){if(!e)return null;for(var n=[],r=0;r<e.length;r+=2){var s=t.map(e[r],1),i=t.map(e[r+1],-1);s<=i&&n.push(s,i)}return n}function histTransaction(e,t,n,r){var s=mustPreserveItems(t),i=l.get(t).spec.config,o=(r?e.undone:e.done).popEvent(t,s);if(o){var a=o.selection.resolve(o.transform.doc),u=(r?e.done:e.undone).addTransform(o.transform,t.selection.getBookmark(),i,s),m=new p(r?u:o.remaining,r?o.remaining:u,null,0);n(o.transform.setSelection(a).setMeta(l,{redo:r,historyState:m}).scrollIntoView())}}var m=!1,h=null;function mustPreserveItems(e){var t=e.plugins;if(h!=t){m=!1,h=t;for(var n=0;n<t.length;n++)if(t[n].spec.historyPreserveItems){m=!0;break}}return m}function closeHistory(e){return e.setMeta(c,!0)}var l=new i.PluginKey("history"),c=new i.PluginKey("closeHistory");function history(e){return e={depth:e&&e.depth||100,newGroupDelay:e&&e.newGroupDelay||500},new i.Plugin({key:l,state:{init:function init(){return new p(o.empty,o.empty,null,0)},apply:function apply(t,n,r){return function applyTransaction(e,t,n,r){var s,i=n.getMeta(l);if(i)return i.historyState;n.getMeta(c)&&(e=new p(e.done,e.undone,null,0));var a=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(a&&a.getMeta(l))return a.getMeta(l).redo?new p(e.done.addTransform(n,null,r,mustPreserveItems(t)),e.undone,rangesFor(n.mapping.maps[n.steps.length-1]),e.prevTime):new p(e.done,e.undone.addTransform(n,null,r,mustPreserveItems(t)),null,e.prevTime);if(!1===n.getMeta("addToHistory")||a&&!1===a.getMeta("addToHistory"))return(s=n.getMeta("rebased"))?new p(e.done.rebased(n,s),e.undone.rebased(n,s),mapRanges(e.prevRanges,n.mapping),e.prevTime):new p(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),mapRanges(e.prevRanges,n.mapping),e.prevTime);var u=0==e.prevTime||!a&&(e.prevTime<(n.time||0)-r.newGroupDelay||!function isAdjacentTo(e,t){if(!t)return!1;if(!e.docChanged)return!0;var n=!1;return e.mapping.maps[0].forEach((function(e,r){for(var s=0;s<t.length;s+=2)e<=t[s+1]&&r>=t[s]&&(n=!0)})),n}(n,e.prevRanges)),m=a?mapRanges(e.prevRanges,n.mapping):rangesFor(n.mapping.maps[n.steps.length-1]);return new p(e.done.addTransform(n,u?t.selection.getBookmark():null,r,mustPreserveItems(t)),o.empty,m,n.time)}(n,r,t,e)}},config:e})}function undo(e,t){var n=l.getState(e);return!(!n||0==n.done.eventCount)&&(t&&histTransaction(n,e,t,!1),!0)}function redo(e,t){var n=l.getState(e);return!(!n||0==n.undone.eventCount)&&(t&&histTransaction(n,e,t,!0),!0)}function undoDepth(e){var t=l.getState(e);return t?t.done.eventCount:0}function redoDepth(e){var t=l.getState(e);return t?t.undone.eventCount:0}}}]);