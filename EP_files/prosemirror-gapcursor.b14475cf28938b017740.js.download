(self.webpackChunkep_web=self.webpackChunkep_web||[]).push([["../libs/wp/prosemirror-gapcursor/prosemirror-gapcursor"],{"./node_modules/prosemirror-gapcursor/dist/index.es.js":function(r,e,o){"use strict";o.d(e,{d:function(){return gapCursor}});var t=o("./node_modules/prosemirror-keymap/dist/index.es.js"),n=o("./node_modules/prosemirror-state/dist/index.es.js"),i=o("./node_modules/prosemirror-view/dist/index.es.js"),s=o("./node_modules/prosemirror-model/dist/index.es.js"),a=function(r){function GapCursor(e){r.call(this,e,e)}return r&&(GapCursor.__proto__=r),GapCursor.prototype=Object.create(r&&r.prototype),GapCursor.prototype.constructor=GapCursor,GapCursor.prototype.map=function map(e,o){var t=e.resolve(o.map(this.head));return GapCursor.valid(t)?new GapCursor(t):r.near(t)},GapCursor.prototype.content=function content(){return s.Slice.empty},GapCursor.prototype.eq=function eq(r){return r instanceof GapCursor&&r.head==this.head},GapCursor.prototype.toJSON=function toJSON(){return{type:"gapcursor",pos:this.head}},GapCursor.fromJSON=function fromJSON(r,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new GapCursor(r.resolve(e.pos))},GapCursor.prototype.getBookmark=function getBookmark(){return new u(this.anchor)},GapCursor.valid=function valid(r){var e=r.parent;if(e.isTextblock||!function closedBefore(r){for(var e=r.depth;e>=0;e--){var o=r.index(e);if(0!=o)for(var t=r.node(e).child(o-1);;t=t.lastChild){if(0==t.childCount&&!t.inlineContent||t.isAtom||t.type.spec.isolating)return!0;if(t.inlineContent)return!1}}return!0}(r)||!function closedAfter(r){for(var e=r.depth;e>=0;e--){var o=r.indexAfter(e),t=r.node(e);if(o!=t.childCount)for(var n=t.child(o);;n=n.firstChild){if(0==n.childCount&&!n.inlineContent||n.isAtom||n.type.spec.isolating)return!0;if(n.inlineContent)return!1}}return!0}(r))return!1;var o=e.type.spec.allowGapCursor;if(null!=o)return o;var t=e.contentMatchAt(r.index()).defaultType;return t&&t.isTextblock},GapCursor.findFrom=function findFrom(r,e,o){r:for(;;){if(!o&&GapCursor.valid(r))return r;for(var t=r.pos,i=null,s=r.depth;;s--){var a=r.node(s);if(e>0?r.indexAfter(s)<a.childCount:r.index(s)>0){i=a.child(e>0?r.indexAfter(s):r.index(s)-1);break}if(0==s)return null;t+=e;var u=r.doc.resolve(t);if(GapCursor.valid(u))return u}for(;;){var p=e>0?i.firstChild:i.lastChild;if(!p){if(i.isAtom&&!i.isText&&!n.NodeSelection.isSelectable(i)){r=r.doc.resolve(t+i.nodeSize*e),o=!1;continue r}break}i=p,t+=e;var l=r.doc.resolve(t);if(GapCursor.valid(l))return l}return null}},GapCursor}(n.Selection);a.prototype.visible=!1,n.Selection.jsonID("gapcursor",a);var u=function GapBookmark(r){this.pos=r};u.prototype.map=function map(r){return new u(r.map(this.pos))},u.prototype.resolve=function resolve(r){var e=r.resolve(this.pos);return a.valid(e)?new a(e):n.Selection.near(e)};var gapCursor=function(){return new n.Plugin({props:{decorations:drawGapCursor,createSelectionBetween:function createSelectionBetween(r,e,o){if(e.pos==o.pos&&a.valid(o))return new a(o)},handleClick:handleClick,handleKeyDown:p}})},p=(0,t.$)({ArrowLeft:arrow("horiz",-1),ArrowRight:arrow("horiz",1),ArrowUp:arrow("vert",-1),ArrowDown:arrow("vert",1)});function arrow(r,e){var o="vert"==r?e>0?"down":"up":e>0?"right":"left";return function(r,t,i){var s=r.selection,u=e>0?s.$to:s.$from,p=s.empty;if(s instanceof n.TextSelection){if(!i.endOfTextblock(o)||0==u.depth)return!1;p=!1,u=r.doc.resolve(e>0?u.after():u.before())}var l=a.findFrom(u,e,p);return!!l&&(t&&t(r.tr.setSelection(new a(l))),!0)}}function handleClick(r,e,o){if(!r.editable)return!1;var t=r.state.doc.resolve(e);if(!a.valid(t))return!1;var i=r.posAtCoords({left:o.clientX,top:o.clientY}).inside;return!(i>-1&&n.NodeSelection.isSelectable(r.state.doc.nodeAt(i)))&&(r.dispatch(r.state.tr.setSelection(new a(t))),!0)}function drawGapCursor(r){if(!(r.selection instanceof a))return null;var e=document.createElement("div");return e.className="ProseMirror-gapcursor",i.DecorationSet.create(r.doc,[i.Decoration.widget(r.selection.head,e,{key:"gapcursor"})])}}}]);