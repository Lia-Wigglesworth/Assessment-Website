(self.webpackChunkep_web=self.webpackChunkep_web||[]).push([["../libs/wp/prosemirror-tables/prosemirror-tables"],{"./node_modules/prosemirror-tables/dist/index.es.js":function(e,t,n){"use strict";n.r(t),n.d(t,{CellSelection:function(){return v},TableMap:function(){return h},__clipCells:function(){return clipCells},__insertCells:function(){return insertCells},__pastedCells:function(){return pastedCells},addColumn:function(){return addColumn},addColumnAfter:function(){return addColumnAfter},addColumnBefore:function(){return addColumnBefore},addRow:function(){return addRow},addRowAfter:function(){return addRowAfter},addRowBefore:function(){return addRowBefore},cellAround:function(){return cellAround},colCount:function(){return colCount},columnResizing:function(){return columnResizing},columnResizingPluginKey:function(){return R},deleteColumn:function(){return deleteColumn},deleteRow:function(){return deleteRow},deleteTable:function(){return deleteTable},findCell:function(){return findCell},fixTables:function(){return fixTables},fixTablesKey:function(){return C},goToNextCell:function(){return goToNextCell},handlePaste:function(){return handlePaste},inSameTable:function(){return inSameTable},isInTable:function(){return isInTable},mergeCells:function(){return mergeCells},moveCellForward:function(){return moveCellForward},nextCell:function(){return nextCell},removeColumn:function(){return removeColumn},removeRow:function(){return removeRow},rowIsHeader:function(){return rowIsHeader},selectedRect:function(){return selectedRect},selectionCell:function(){return selectionCell},setCellAttr:function(){return setCellAttr},splitCell:function(){return splitCell},splitCellWithType:function(){return splitCellWithType},tableEditing:function(){return tableEditing},tableEditingKey:function(){return m},tableNodes:function(){return tableNodes},toggleHeader:function(){return toggleHeader},toggleHeaderCell:function(){return y},toggleHeaderColumn:function(){return S},toggleHeaderRow:function(){return b},updateColumnsOnResize:function(){return updateColumns}});var r,o,l=n("./node_modules/prosemirror-state/dist/index.es.js"),a=n("./node_modules/prosemirror-model/dist/index.es.js"),i=n("./node_modules/prosemirror-keymap/dist/index.es.js"),s=n("./node_modules/prosemirror-view/dist/index.es.js"),c=n("./node_modules/prosemirror-transform/dist/index.es.js");if("undefined"!=typeof WeakMap){var d=new WeakMap;r=function(e){return d.get(e)},o=function(e,t){return d.set(e,t),t}}else{var p=[],u=0;r=function(e){for(var t=0;t<p.length;t+=2)if(p[t]==e)return p[t+1]},o=function(e,t){return 10==u&&(u=0),p[u++]=e,p[u++]=t}}var f=function Rect(e,t,n,r){this.left=e,this.top=t,this.right=n,this.bottom=r},h=function TableMap(e,t,n,r){this.width=e,this.height=t,this.map=n,this.problems=r};function freshColWidth(e){if(e.colwidth)return e.colwidth.slice();for(var t=[],n=0;n<e.colspan;n++)t.push(0);return t}h.prototype.findCell=function findCell(e){for(var t=0;t<this.map.length;t++){var n=this.map[t];if(n==e){for(var r=t%this.width,o=t/this.width|0,l=r+1,a=o+1,i=1;l<this.width&&this.map[t+i]==n;i++)l++;for(var s=1;a<this.height&&this.map[t+this.width*s]==n;s++)a++;return new f(r,o,l,a)}}throw new RangeError("No cell with offset "+e+" found")},h.prototype.colCount=function colCount(e){for(var t=0;t<this.map.length;t++)if(this.map[t]==e)return t%this.width;throw new RangeError("No cell with offset "+e+" found")},h.prototype.nextCell=function nextCell(e,t,n){var r=this.findCell(e),o=r.left,l=r.right,a=r.top,i=r.bottom;return"horiz"==t?(n<0?0==o:l==this.width)?null:this.map[a*this.width+(n<0?o-1:l)]:(n<0?0==a:i==this.height)?null:this.map[o+this.width*(n<0?a-1:i)]},h.prototype.rectBetween=function rectBetween(e,t){var n=this.findCell(e),r=n.left,o=n.right,l=n.top,a=n.bottom,i=this.findCell(t),s=i.left,c=i.right,d=i.top,p=i.bottom;return new f(Math.min(r,s),Math.min(l,d),Math.max(o,c),Math.max(a,p))},h.prototype.cellsInRect=function cellsInRect(e){for(var t=[],n={},r=e.top;r<e.bottom;r++)for(var o=e.left;o<e.right;o++){var l=r*this.width+o,a=this.map[l];n[a]||(n[a]=!0,o==e.left&&o&&this.map[l-1]==a||r==e.top&&r&&this.map[l-this.width]==a||t.push(a))}return t},h.prototype.positionAt=function positionAt(e,t,n){for(var r=0,o=0;;r++){var l=o+n.child(r).nodeSize;if(r==e){for(var a=t+e*this.width,i=(e+1)*this.width;a<i&&this.map[a]<o;)a++;return a==i?l-1:this.map[a]}o=l}},h.get=function get(e){return r(e)||o(e,function computeMap(e){if("table"!=e.type.spec.tableRole)throw new RangeError("Not a table node: "+e.type.name);for(var t=function findWidth(e){for(var t=-1,n=!1,r=0;r<e.childCount;r++){var o=e.child(r),l=0;if(n)for(var a=0;a<r;a++)for(var i=e.child(a),s=0;s<i.childCount;s++){var c=i.child(s);a+c.attrs.rowspan>r&&(l+=c.attrs.colspan)}for(var d=0;d<o.childCount;d++){var p=o.child(d);l+=p.attrs.colspan,p.attrs.rowspan>1&&(n=!0)}-1==t?t=l:t!=l&&(t=Math.max(t,l))}return t}(e),n=e.childCount,r=[],o=0,l=null,a=[],i=0,s=t*n;i<s;i++)r[i]=0;for(var c=0,d=0;c<n;c++){var p=e.child(c);d++;for(var u=0;;u++){for(;o<r.length&&0!=r[o];)o++;if(u==p.childCount)break;for(var f=p.child(u),m=f.attrs,v=m.colspan,w=m.rowspan,g=m.colwidth,C=0;C<w;C++){if(C+c>=n){(l||(l=[])).push({type:"overlong_rowspan",pos:d,n:w-C});break}for(var b=o+C*t,S=0;S<v;S++){0==r[b+S]?r[b+S]=d:(l||(l=[])).push({type:"collision",row:c,pos:d,n:v-S});var y=g&&g[S];if(y){var A=(b+S)%t*2,R=a[A];null==R||R!=y&&1==a[A+1]?(a[A]=y,a[A+1]=1):R==y&&a[A+1]++}}}o+=v,d+=f.nodeSize}for(var T=(c+1)*t,M=0;o<T;)0==r[o++]&&M++;M&&(l||(l=[])).push({type:"missing",row:c,n:M}),d++}for(var $=new h(t,n,r,l),N=!1,x=0;!N&&x<a.length;x+=2)null!=a[x]&&a[x+1]<n&&(N=!0);N&&function findBadColWidths(e,t,n){e.problems||(e.problems=[]);for(var r=0,o={};r<e.map.length;r++){var l=e.map[r];if(!o[l]){o[l]=!0;for(var a=n.nodeAt(l),i=null,s=0;s<a.attrs.colspan;s++){var c=t[2*((r+s)%e.width)];null==c||a.attrs.colwidth&&a.attrs.colwidth[s]==c||((i||(i=freshColWidth(a.attrs)))[s]=c)}i&&e.problems.unshift({type:"colwidth mismatch",pos:l,colwidth:i})}}}($,a,e);return $}(e))};var m=new l.PluginKey("selectingCells");function cellAround(e){for(var t=e.depth-1;t>0;t--)if("row"==e.node(t).type.spec.tableRole)return e.node(0).resolve(e.before(t+1));return null}function isInTable(e){for(var t=e.selection.$head,n=t.depth;n>0;n--)if("row"==t.node(n).type.spec.tableRole)return!0;return!1}function selectionCell(e){var t=e.selection;return t.$anchorCell?t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell:t.node&&"cell"==t.node.type.spec.tableRole?t.$anchor:cellAround(t.$head)||function cellNear(e){for(var t=e.nodeAfter,n=e.pos;t;t=t.firstChild,n++){var r=t.type.spec.tableRole;if("cell"==r||"header_cell"==r)return e.doc.resolve(n)}for(var o=e.nodeBefore,l=e.pos;o;o=o.lastChild,l--){var a=o.type.spec.tableRole;if("cell"==a||"header_cell"==a)return e.doc.resolve(l-o.nodeSize)}}(t.$head)}function pointsAtCell(e){return"row"==e.parent.type.spec.tableRole&&e.nodeAfter}function moveCellForward(e){return e.node(0).resolve(e.pos+e.nodeAfter.nodeSize)}function inSameTable(e,t){return e.depth==t.depth&&e.pos>=t.start(-1)&&e.pos<=t.end(-1)}function findCell(e){return h.get(e.node(-1)).findCell(e.pos-e.start(-1))}function colCount(e){return h.get(e.node(-1)).colCount(e.pos-e.start(-1))}function nextCell(e,t,n){var r=e.start(-1),o=h.get(e.node(-1)).nextCell(e.pos-r,t,n);return null==o?null:e.node(0).resolve(r+o)}function setAttr(e,t,n){var r={};for(var o in e)r[o]=e[o];return r[t]=n,r}function rmColSpan(e,t,n){void 0===n&&(n=1);var r=setAttr(e,"colspan",e.colspan-n);return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(t,n),r.colwidth.some((function(e){return e>0}))||(r.colwidth=null)),r}function addColSpan(e,t,n){void 0===n&&(n=1);var r=setAttr(e,"colspan",e.colspan+n);if(r.colwidth){r.colwidth=r.colwidth.slice();for(var o=0;o<n;o++)r.colwidth.splice(t,0,0)}return r}var v=function(e){function CellSelection(t,n){void 0===n&&(n=t);var r=t.node(-1),o=h.get(r),a=t.start(-1),i=o.rectBetween(t.pos-a,n.pos-a),s=t.node(0),c=o.cellsInRect(i).filter((function(e){return e!=n.pos-a}));c.unshift(n.pos-a);var d=c.map((function(e){var t=r.nodeAt(e),n=e+a+1;return new l.SelectionRange(s.resolve(n),s.resolve(n+t.content.size))}));e.call(this,d[0].$from,d[0].$to,d),this.$anchorCell=t,this.$headCell=n}return e&&(CellSelection.__proto__=e),CellSelection.prototype=Object.create(e&&e.prototype),CellSelection.prototype.constructor=CellSelection,CellSelection.prototype.map=function map(e,t){var n=e.resolve(t.map(this.$anchorCell.pos)),r=e.resolve(t.map(this.$headCell.pos));if(pointsAtCell(n)&&pointsAtCell(r)&&inSameTable(n,r)){var o=this.$anchorCell.node(-1)!=n.node(-1);return o&&this.isRowSelection()?CellSelection.rowSelection(n,r):o&&this.isColSelection()?CellSelection.colSelection(n,r):new CellSelection(n,r)}return l.TextSelection.between(n,r)},CellSelection.prototype.content=function content(){for(var e=this.$anchorCell.node(-1),t=h.get(e),n=this.$anchorCell.start(-1),r=t.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n),o={},l=[],i=r.top;i<r.bottom;i++){for(var s=[],c=i*t.width+r.left,d=r.left;d<r.right;d++,c++){var p=t.map[c];if(!o[p]){o[p]=!0;var u=t.findCell(p),f=e.nodeAt(p),m=r.left-u.left,v=u.right-r.right;if(m>0||v>0){var w=f.attrs;m>0&&(w=rmColSpan(w,0,m)),v>0&&(w=rmColSpan(w,w.colspan-v,v)),f=u.left<r.left?f.type.createAndFill(w):f.type.create(w,f.content)}if(u.top<r.top||u.bottom>r.bottom){var g=setAttr(f.attrs,"rowspan",Math.min(u.bottom,r.bottom)-Math.max(u.top,r.top));f=u.top<r.top?f.type.createAndFill(g):f.type.create(g,f.content)}s.push(f)}}l.push(e.child(i).copy(a.Fragment.from(s)))}var C=this.isColSelection()&&this.isRowSelection()?e:l;return new a.Slice(a.Fragment.from(C),1,1)},CellSelection.prototype.replace=function replace(t,n){void 0===n&&(n=a.Slice.empty);for(var r=t.steps.length,o=this.ranges,l=0;l<o.length;l++){var i=o[l],s=i.$from,c=i.$to,d=t.mapping.slice(r);t.replace(d.map(s.pos),d.map(c.pos),l?a.Slice.empty:n)}var p=e.findFrom(t.doc.resolve(t.mapping.slice(r).map(this.to)),-1);p&&t.setSelection(p)},CellSelection.prototype.replaceWith=function replaceWith(e,t){this.replace(e,new a.Slice(a.Fragment.from(t),0,0))},CellSelection.prototype.forEachCell=function forEachCell(e){for(var t=this.$anchorCell.node(-1),n=h.get(t),r=this.$anchorCell.start(-1),o=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r)),l=0;l<o.length;l++)e(t.nodeAt(o[l]),r+o[l])},CellSelection.prototype.isColSelection=function isColSelection(){var e=this.$anchorCell.index(-1),t=this.$headCell.index(-1);if(Math.min(e,t)>0)return!1;var n=e+this.$anchorCell.nodeAfter.attrs.rowspan,r=t+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,r)==this.$headCell.node(-1).childCount},CellSelection.colSelection=function colSelection(e,t){void 0===t&&(t=e);var n=h.get(e.node(-1)),r=e.start(-1),o=n.findCell(e.pos-r),l=n.findCell(t.pos-r),a=e.node(0);return o.top<=l.top?(o.top>0&&(e=a.resolve(r+n.map[o.left])),l.bottom<n.height&&(t=a.resolve(r+n.map[n.width*(n.height-1)+l.right-1]))):(l.top>0&&(t=a.resolve(r+n.map[l.left])),o.bottom<n.height&&(e=a.resolve(r+n.map[n.width*(n.height-1)+o.right-1]))),new CellSelection(e,t)},CellSelection.prototype.isRowSelection=function isRowSelection(){var e=h.get(this.$anchorCell.node(-1)),t=this.$anchorCell.start(-1),n=e.colCount(this.$anchorCell.pos-t),r=e.colCount(this.$headCell.pos-t);if(Math.min(n,r)>0)return!1;var o=n+this.$anchorCell.nodeAfter.attrs.colspan,l=r+this.$headCell.nodeAfter.attrs.colspan;return Math.max(o,l)==e.width},CellSelection.prototype.eq=function eq(e){return e instanceof CellSelection&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos},CellSelection.rowSelection=function rowSelection(e,t){void 0===t&&(t=e);var n=h.get(e.node(-1)),r=e.start(-1),o=n.findCell(e.pos-r),l=n.findCell(t.pos-r),a=e.node(0);return o.left<=l.left?(o.left>0&&(e=a.resolve(r+n.map[o.top*n.width])),l.right<n.width&&(t=a.resolve(r+n.map[n.width*(l.top+1)-1]))):(l.left>0&&(t=a.resolve(r+n.map[l.top*n.width])),o.right<n.width&&(e=a.resolve(r+n.map[n.width*(o.top+1)-1]))),new CellSelection(e,t)},CellSelection.prototype.toJSON=function toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}},CellSelection.fromJSON=function fromJSON(e,t){return new CellSelection(e.resolve(t.anchor),e.resolve(t.head))},CellSelection.create=function create(e,t,n){return void 0===n&&(n=t),new CellSelection(e.resolve(t),e.resolve(n))},CellSelection.prototype.getBookmark=function getBookmark(){return new w(this.$anchorCell.pos,this.$headCell.pos)},CellSelection}(l.Selection);v.prototype.visible=!1,l.Selection.jsonID("cell",v);var w=function CellBookmark(e,t){this.anchor=e,this.head=t};function drawCellSelection(e){if(!(e.selection instanceof v))return null;var t=[];return e.selection.forEachCell((function(e,n){t.push(s.Decoration.node(n,n+e.nodeSize,{class:"selectedCell"}))})),s.DecorationSet.create(e.doc,t)}function getCellAttrs(e,t){var n=e.getAttribute("data-colwidth"),r=n&&/^\d+(,\d+)*$/.test(n)?n.split(",").map((function(e){return Number(e)})):null,o=Number(e.getAttribute("colspan")||1),l={colspan:o,rowspan:Number(e.getAttribute("rowspan")||1),colwidth:r&&r.length==o?r:null};for(var a in t){var i=t[a].getFromDOM,s=i&&i(e);null!=s&&(l[a]=s)}return l}function setCellAttrs(e,t){var n={};for(var r in 1!=e.attrs.colspan&&(n.colspan=e.attrs.colspan),1!=e.attrs.rowspan&&(n.rowspan=e.attrs.rowspan),e.attrs.colwidth&&(n["data-colwidth"]=e.attrs.colwidth.join(",")),t){var o=t[r].setDOMAttr;o&&o(e.attrs[r],n)}return n}function tableNodes(e){var t=e.cellAttributes||{},n={colspan:{default:1},rowspan:{default:1},colwidth:{default:null}};for(var r in t)n[r]={default:t[r].default};return{table:{content:"table_row+",tableRole:"table",isolating:!0,group:e.tableGroup,parseDOM:[{tag:"table"}],toDOM:function toDOM(){return["table",["tbody",0]]}},table_row:{content:"(table_cell | table_header)*",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM:function toDOM(){return["tr",0]}},table_cell:{content:e.cellContent,attrs:n,tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs:function(e){return getCellAttrs(e,t)}}],toDOM:function toDOM(e){return["td",setCellAttrs(e,t),0]}},table_header:{content:e.cellContent,attrs:n,tableRole:"header_cell",isolating:!0,parseDOM:[{tag:"th",getAttrs:function(e){return getCellAttrs(e,t)}}],toDOM:function toDOM(e){return["th",setCellAttrs(e,t),0]}}}}function tableNodeTypes(e){var t=e.cached.tableNodeTypes;if(!t)for(var n in t=e.cached.tableNodeTypes={},e.nodes){var r=e.nodes[n],o=r.spec.tableRole;o&&(t[o]=r)}return t}function pastedCells(e){if(!e.size)return null;for(var t=e.content,n=e.openStart,r=e.openEnd;1==t.childCount&&(n>0&&r>0||"table"==t.firstChild.type.spec.tableRole);)n--,r--,t=t.firstChild.content;var o=t.firstChild,l=o.type.spec.tableRole,i=o.type.schema,s=[];if("row"==l)for(var c=0;c<t.childCount;c++){var d=t.child(c).content,p=c?0:Math.max(0,n-1),u=c<t.childCount-1?0:Math.max(0,r-1);(p||u)&&(d=fitSlice(tableNodeTypes(i).row,new a.Slice(d,p,u)).content),s.push(d)}else{if("cell"!=l&&"header_cell"!=l)return null;s.push(n||r?fitSlice(tableNodeTypes(i).row,new a.Slice(t,n,r)).content:t)}return function ensureRectangular(e,t){for(var n=[],r=0;r<t.length;r++)for(var o=t[r],l=o.childCount-1;l>=0;l--)for(var i=o.child(l).attrs,s=i.rowspan,c=i.colspan,d=r;d<r+s;d++)n[d]=(n[d]||0)+c;for(var p=0,u=0;u<n.length;u++)p=Math.max(p,n[u]);for(var f=0;f<n.length;f++)if(f>=t.length&&t.push(a.Fragment.empty),n[f]<p){for(var h=tableNodeTypes(e).cell.createAndFill(),m=[],v=n[f];v<p;v++)m.push(h);t[f]=t[f].append(a.Fragment.from(m))}return{height:t.length,width:p,rows:t}}(i,s)}function fitSlice(e,t){var n=e.createAndFill();return new c.Transform(n).replace(0,n.content.size,t).doc}function clipCells(e,t,n){var r=e.width,o=e.height,l=e.rows;if(r!=t){for(var i=[],s=[],c=0;c<l.length;c++){for(var d=l[c],p=[],u=i[c]||0,f=0;u<t;f++){var h=d.child(f%d.childCount);u+h.attrs.colspan>t&&(h=h.type.create(rmColSpan(h.attrs,h.attrs.colspan,u+h.attrs.colspan-t),h.content)),p.push(h),u+=h.attrs.colspan;for(var m=1;m<h.attrs.rowspan;m++)i[c+m]=(i[c+m]||0)+h.attrs.colspan}s.push(a.Fragment.from(p))}l=s,r=t}if(o!=n){for(var v=[],w=0,g=0;w<n;w++,g++){for(var C=[],b=l[g%o],S=0;S<b.childCount;S++){var y=b.child(S);w+y.attrs.rowspan>n&&(y=y.type.create(setAttr(y.attrs,"rowspan",n-y.attrs.rowspan),y.content)),C.push(y)}v.push(a.Fragment.from(C))}l=v,o=n}return{width:r,height:o,rows:l}}function isolateHorizontal(e,t,n,r,o,l,a,i){if(0==a||a==t.height)return!1;for(var s=!1,c=o;c<l;c++){var d=a*t.width+c,p=t.map[d];if(t.map[d-t.width]==p){s=!0;var u=n.nodeAt(p),f=t.findCell(p),h=f.top,m=f.left;e.setNodeMarkup(e.mapping.slice(i).map(p+r),null,setAttr(u.attrs,"rowspan",a-h)),e.insert(e.mapping.slice(i).map(t.positionAt(a,m,n)),u.type.createAndFill(setAttr(u.attrs,"rowspan",h+u.attrs.rowspan-a))),c+=u.attrs.colspan-1}}return s}function isolateVertical(e,t,n,r,o,l,a,i){if(0==a||a==t.width)return!1;for(var s=!1,c=o;c<l;c++){var d=c*t.width+a,p=t.map[d];if(t.map[d-1]==p){s=!0;var u=n.nodeAt(p),f=t.colCount(p),h=e.mapping.slice(i).map(p+r);e.setNodeMarkup(h,null,rmColSpan(u.attrs,a-f,u.attrs.colspan-(a-f))),e.insert(h+u.nodeSize,u.type.createAndFill(rmColSpan(u.attrs,0,a-f))),c+=u.attrs.rowspan-1}}return s}function insertCells(e,t,n,r,o){var l=n?e.doc.nodeAt(n-1):e.doc,i=h.get(l),s=r.top,c=r.left,d=c+o.width,p=s+o.height,u=e.tr,f=0;function recomp(){l=n?u.doc.nodeAt(n-1):u.doc,i=h.get(l),f=u.mapping.maps.length}(function growTable(e,t,n,r,o,l,i){var s,c,d=tableNodeTypes(e.doc.type.schema);if(o>t.width)for(var p=0,u=0;p<t.height;p++){var f=n.child(p);u+=f.nodeSize;var h=[],m=void 0;m=null==f.lastChild||f.lastChild.type==d.cell?s||(s=d.cell.createAndFill()):c||(c=d.header_cell.createAndFill());for(var v=t.width;v<o;v++)h.push(m);e.insert(e.mapping.slice(i).map(u-1+r),h)}if(l>t.height){for(var w=[],g=0,C=(t.height-1)*t.width;g<Math.max(t.width,o);g++){var b=!(g>=t.width)&&n.nodeAt(t.map[C+g]).type==d.header_cell;w.push(b?c||(c=d.header_cell.createAndFill()):s||(s=d.cell.createAndFill()))}for(var S=d.row.create(null,a.Fragment.from(w)),y=[],A=t.height;A<l;A++)y.push(S);e.insert(e.mapping.slice(i).map(r+n.nodeSize-2),y)}return!(!s&&!c)})(u,i,l,n,d,p,f)&&recomp(),isolateHorizontal(u,i,l,n,c,d,s,f)&&recomp(),isolateHorizontal(u,i,l,n,c,d,p,f)&&recomp(),isolateVertical(u,i,l,n,s,p,c,f)&&recomp(),isolateVertical(u,i,l,n,s,p,d,f)&&recomp();for(var m=s;m<p;m++){var w=i.positionAt(m,c,l),g=i.positionAt(m,d,l);u.replace(u.mapping.slice(f).map(w+n),u.mapping.slice(f).map(g+n),new a.Slice(o.rows[m-s],0,0))}recomp(),u.setSelection(new v(u.doc.resolve(n+i.positionAt(s,c,l)),u.doc.resolve(n+i.positionAt(p-1,d-1,l)))),t(u)}w.prototype.map=function map(e){return new w(e.map(this.anchor),e.map(this.head))},w.prototype.resolve=function resolve(e){var t=e.resolve(this.anchor),n=e.resolve(this.head);return"row"==t.parent.type.spec.tableRole&&"row"==n.parent.type.spec.tableRole&&t.index()<t.parent.childCount&&n.index()<n.parent.childCount&&inSameTable(t,n)?new v(t,n):l.Selection.near(n,1)};var g=(0,i.$)({ArrowLeft:arrow("horiz",-1),ArrowRight:arrow("horiz",1),ArrowUp:arrow("vert",-1),ArrowDown:arrow("vert",1),"Shift-ArrowLeft":shiftArrow("horiz",-1),"Shift-ArrowRight":shiftArrow("horiz",1),"Shift-ArrowUp":shiftArrow("vert",-1),"Shift-ArrowDown":shiftArrow("vert",1),Backspace:deleteCellSelection,"Mod-Backspace":deleteCellSelection,Delete:deleteCellSelection,"Mod-Delete":deleteCellSelection});function maybeSetSelection(e,t,n){return!n.eq(e.selection)&&(t&&t(e.tr.setSelection(n).scrollIntoView()),!0)}function arrow(e,t){return function(n,r,o){var a=n.selection;if(a instanceof v)return maybeSetSelection(n,r,l.Selection.near(a.$headCell,t));if("horiz"!=e&&!a.empty)return!1;var i=atEndOfCell(o,e,t);if(null==i)return!1;if("horiz"==e)return maybeSetSelection(n,r,l.Selection.near(n.doc.resolve(a.head+t),t));var s,c=n.doc.resolve(i),d=nextCell(c,e,t);return s=d?l.Selection.near(d,1):t<0?l.Selection.near(n.doc.resolve(c.before(-1)),-1):l.Selection.near(n.doc.resolve(c.after(-1)),1),maybeSetSelection(n,r,s)}}function shiftArrow(e,t){return function(n,r,o){var l=n.selection;if(!(l instanceof v)){var a=atEndOfCell(o,e,t);if(null==a)return!1;l=new v(n.doc.resolve(a))}var i=nextCell(l.$headCell,e,t);return!!i&&maybeSetSelection(n,r,new v(l.$anchorCell,i))}}function deleteCellSelection(e,t){var n=e.selection;if(!(n instanceof v))return!1;if(t){var r=e.tr,o=tableNodeTypes(e.schema).cell.createAndFill().content;n.forEachCell((function(e,t){e.content.eq(o)||r.replace(r.mapping.map(t+1),r.mapping.map(t+e.nodeSize-1),new a.Slice(o,0,0))})),r.docChanged&&t(r)}return!0}function handleTripleClick(e,t){var n=cellAround(e.state.doc.resolve(t));return!!n&&(e.dispatch(e.state.tr.setSelection(new v(n))),!0)}function handlePaste(e,t,n){if(!isInTable(e.state))return!1;var r=pastedCells(n),o=e.state.selection;if(o instanceof v){r||(r={width:1,height:1,rows:[a.Fragment.from(fitSlice(tableNodeTypes(e.state.schema).cell,n))]});var l=o.$anchorCell.node(-1),i=o.$anchorCell.start(-1),s=h.get(l).rectBetween(o.$anchorCell.pos-i,o.$headCell.pos-i);return r=clipCells(r,s.right-s.left,s.bottom-s.top),insertCells(e.state,e.dispatch,i,s,r),!0}if(r){var c=selectionCell(e.state),d=c.start(-1);return insertCells(e.state,e.dispatch,d,h.get(c.node(-1)).findCell(c.pos-d),r),!0}return!1}function handleMouseDown(e,t){if(!t.ctrlKey&&!t.metaKey){var n,r=domInCell(e,t.target);if(t.shiftKey&&e.state.selection instanceof v)setCellSelection(e.state.selection.$anchorCell,t),t.preventDefault();else if(t.shiftKey&&r&&null!=(n=cellAround(e.state.selection.$anchor))&&cellUnderMouse(e,t).pos!=n.pos)setCellSelection(n,t),t.preventDefault();else if(!r)return;e.root.addEventListener("mouseup",stop),e.root.addEventListener("dragstart",stop),e.root.addEventListener("mousemove",move)}function setCellSelection(t,n){var r=cellUnderMouse(e,n),o=null==m.getState(e.state);if(!r||!inSameTable(t,r)){if(!o)return;r=t}var l=new v(t,r);if(o||!e.state.selection.eq(l)){var a=e.state.tr.setSelection(l);o&&a.setMeta(m,t.pos),e.dispatch(a)}}function stop(){e.root.removeEventListener("mouseup",stop),e.root.removeEventListener("dragstart",stop),e.root.removeEventListener("mousemove",move),null!=m.getState(e.state)&&e.dispatch(e.state.tr.setMeta(m,-1))}function move(n){var o,l=m.getState(e.state);if(null!=l)o=e.state.doc.resolve(l);else if(domInCell(e,n.target)!=r&&!(o=cellUnderMouse(e,t)))return stop();o&&setCellSelection(o,n)}}function atEndOfCell(e,t,n){if(!(e.state.selection instanceof l.TextSelection))return null;for(var r=e.state.selection.$head,o=r.depth-1;o>=0;o--){var a=r.node(o);if((n<0?r.index(o):r.indexAfter(o))!=(n<0?0:a.childCount))return null;if("cell"==a.type.spec.tableRole||"header_cell"==a.type.spec.tableRole){var i=r.before(o),s="vert"==t?n>0?"down":"up":n>0?"right":"left";return e.endOfTextblock(s)?i:null}}return null}function domInCell(e,t){for(;t&&t!=e.dom;t=t.parentNode)if("TD"==t.nodeName||"TH"==t.nodeName)return t}function cellUnderMouse(e,t){var n=e.posAtCoords({left:t.clientX,top:t.clientY});return n&&n?cellAround(e.state.doc.resolve(n.pos)):null}var C=new l.PluginKey("fix-tables");function changedDescendants(e,t,n,r){var o=e.childCount,l=t.childCount;e:for(var a=0,i=0;a<l;a++){for(var s=t.child(a),c=i,d=Math.min(o,a+3);c<d;c++)if(e.child(c)==s){i=c+1,n+=s.nodeSize;continue e}r(s,n),i<o&&e.child(i).sameMarkup(s)?changedDescendants(e.child(i),s,n+1,r):s.nodesBetween(0,s.content.size,r,n+1),n+=s.nodeSize}}function fixTables(e,t){var n,check=function(t,r){"table"==t.type.spec.tableRole&&(n=function fixTable(e,t,n,r){var o=h.get(t);if(!o.problems)return r;r||(r=e.tr);for(var l,a,i=[],s=0;s<o.height;s++)i.push(0);for(var c=0;c<o.problems.length;c++){var d=o.problems[c];if("collision"==d.type){for(var p=t.nodeAt(d.pos),u=0;u<p.attrs.rowspan;u++)i[d.row+u]+=d.n;r.setNodeMarkup(r.mapping.map(n+1+d.pos),null,rmColSpan(p.attrs,p.attrs.colspan-d.n,d.n))}else if("missing"==d.type)i[d.row]+=d.n;else if("overlong_rowspan"==d.type){var f=t.nodeAt(d.pos);r.setNodeMarkup(r.mapping.map(n+1+d.pos),null,setAttr(f.attrs,"rowspan",f.attrs.rowspan-d.n))}else if("colwidth mismatch"==d.type){var m=t.nodeAt(d.pos);r.setNodeMarkup(r.mapping.map(n+1+d.pos),null,setAttr(m.attrs,"colwidth",d.colwidth))}}for(var v=0;v<i.length;v++)i[v]&&(null==l&&(l=v),a=v);for(var w=0,g=n+1;w<o.height;w++){var b=t.child(w),S=g+b.nodeSize,y=i[w];if(y>0){var A="cell";b.firstChild&&(A=b.firstChild.type.spec.tableRole);for(var R=[],T=0;T<y;T++)R.push(tableNodeTypes(e.schema)[A].createAndFill());var M=0!=w&&l!=w-1||a!=w?S-1:g+1;r.insert(r.mapping.map(M),R)}g=S}return r.setMeta(C,{fixTables:!0})}(e,t,r,n))};return t?t.doc!=e.doc&&changedDescendants(t.doc,e.doc,0,check):e.doc.descendants(check),n}function selectedRect(e){var t,n=e.selection,r=selectionCell(e),o=r.node(-1),l=r.start(-1),a=h.get(o);return(t=n instanceof v?a.rectBetween(n.$anchorCell.pos-l,n.$headCell.pos-l):a.findCell(r.pos-l)).tableStart=l,t.map=a,t.table=o,t}function addColumn(e,t,n){var r=t.map,o=t.tableStart,l=t.table,a=n>0?-1:0;(function columnIsHeader(e,t,n){for(var r=tableNodeTypes(t.type.schema).header_cell,o=0;o<e.height;o++)if(t.nodeAt(e.map[n+o*e.width]).type!=r)return!1;return!0})(r,l,n+a)&&(a=0==n||n==r.width?null:0);for(var i=0;i<r.height;i++){var s=i*r.width+n;if(n>0&&n<r.width&&r.map[s-1]==r.map[s]){var c=r.map[s],d=l.nodeAt(c);e.setNodeMarkup(e.mapping.map(o+c),null,addColSpan(d.attrs,n-r.colCount(c))),i+=d.attrs.rowspan-1}else{var p=null==a?tableNodeTypes(l.type.schema).cell:l.nodeAt(r.map[s+a]).type,u=r.positionAt(i,n,l);e.insert(e.mapping.map(o+u),p.createAndFill())}}return e}function addColumnBefore(e,t){if(!isInTable(e))return!1;if(t){var n=selectedRect(e);t(addColumn(e.tr,n,n.left))}return!0}function addColumnAfter(e,t){if(!isInTable(e))return!1;if(t){var n=selectedRect(e);t(addColumn(e.tr,n,n.right))}return!0}function removeColumn(e,t,n){for(var r=t.map,o=t.table,l=t.tableStart,a=e.mapping.maps.length,i=0;i<r.height;){var s=i*r.width+n,c=r.map[s],d=o.nodeAt(c);if(n>0&&r.map[s-1]==c||n<r.width-1&&r.map[s+1]==c)e.setNodeMarkup(e.mapping.slice(a).map(l+c),null,rmColSpan(d.attrs,n-r.colCount(c)));else{var p=e.mapping.slice(a).map(l+c);e.delete(p,p+d.nodeSize)}i+=d.attrs.rowspan}}function deleteColumn(e,t){if(!isInTable(e))return!1;if(t){var n=selectedRect(e),r=e.tr;if(0==n.left&&n.right==n.map.width)return!1;for(var o=n.right-1;removeColumn(r,n,o),o!=n.left;o--)n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=h.get(n.table);t(r)}return!0}function rowIsHeader(e,t,n){for(var r=tableNodeTypes(t.type.schema).header_cell,o=0;o<e.width;o++)if(t.nodeAt(e.map[o+n*e.width]).type!=r)return!1;return!0}function addRow(e,t,n){for(var r=t.map,o=t.tableStart,l=t.table,a=o,i=0;i<n;i++)a+=l.child(i).nodeSize;var s=[],c=n>0?-1:0;rowIsHeader(r,l,n+c)&&(c=0==n||n==r.height?null:0);for(var d=0,p=r.width*n;d<r.width;d++,p++)if(n>0&&n<r.height&&r.map[p]==r.map[p-r.width]){var u=r.map[p],f=l.nodeAt(u).attrs;e.setNodeMarkup(o+u,null,setAttr(f,"rowspan",f.rowspan+1)),d+=f.colspan-1}else{var h=null==c?tableNodeTypes(l.type.schema).cell:l.nodeAt(r.map[p+c*r.width]).type;s.push(h.createAndFill())}return e.insert(a,tableNodeTypes(l.type.schema).row.create(null,s)),e}function addRowBefore(e,t){if(!isInTable(e))return!1;if(t){var n=selectedRect(e);t(addRow(e.tr,n,n.top))}return!0}function addRowAfter(e,t){if(!isInTable(e))return!1;if(t){var n=selectedRect(e);t(addRow(e.tr,n,n.bottom))}return!0}function removeRow(e,t,n){for(var r=t.map,o=t.table,l=t.tableStart,a=0,i=0;i<n;i++)a+=o.child(i).nodeSize;var s=a+o.child(n).nodeSize,c=e.mapping.maps.length;e.delete(a+l,s+l);for(var d=0,p=n*r.width;d<r.width;d++,p++){var u=r.map[p];if(n>0&&u==r.map[p-r.width]){var f=o.nodeAt(u).attrs;e.setNodeMarkup(e.mapping.slice(c).map(u+l),null,setAttr(f,"rowspan",f.rowspan-1)),d+=f.colspan-1}else if(n<r.width&&u==r.map[p+r.width]){var h=o.nodeAt(u),m=h.type.create(setAttr(h.attrs,"rowspan",h.attrs.rowspan-1),h.content),v=r.positionAt(n+1,d,o);e.insert(e.mapping.slice(c).map(l+v),m),d+=h.attrs.colspan-1}}}function deleteRow(e,t){if(!isInTable(e))return!1;if(t){var n=selectedRect(e),r=e.tr;if(0==n.top&&n.bottom==n.map.height)return!1;for(var o=n.bottom-1;removeRow(r,n,o),o!=n.top;o--)n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=h.get(n.table);t(r)}return!0}function isEmpty(e){var t=e.content;return 1==t.childCount&&t.firstChild.isTextblock&&0==t.firstChild.childCount}function mergeCells(e,t){var n=e.selection;if(!(n instanceof v)||n.$anchorCell.pos==n.$headCell.pos)return!1;var r=selectedRect(e),o=r.map;if(function cellsOverlapRectangle(e,t){for(var n=e.width,r=e.height,o=e.map,l=t.top*n+t.left,a=l,i=(t.bottom-1)*n+t.left,s=l+(t.right-t.left-1),c=t.top;c<t.bottom;c++){if(t.left>0&&o[a]==o[a-1]||t.right<n&&o[s]==o[s+1])return!0;a+=n,s+=n}for(var d=t.left;d<t.right;d++){if(t.top>0&&o[l]==o[l-n]||t.bottom<r&&o[i]==o[i+n])return!0;l++,i++}return!1}(o,r))return!1;if(t){for(var l,i,s=e.tr,c={},d=a.Fragment.empty,p=r.top;p<r.bottom;p++)for(var u=r.left;u<r.right;u++){var f=o.map[p*o.width+u],h=r.table.nodeAt(f);if(!c[f])if(c[f]=!0,null==l)l=f,i=h;else{isEmpty(h)||(d=d.append(h.content));var m=s.mapping.map(f+r.tableStart);s.delete(m,m+h.nodeSize)}}if(s.setNodeMarkup(l+r.tableStart,null,setAttr(addColSpan(i.attrs,i.attrs.colspan,r.right-r.left-i.attrs.colspan),"rowspan",r.bottom-r.top)),d.size){var w=l+1+i.content.size,g=isEmpty(i)?l+1:w;s.replaceWith(g+r.tableStart,w+r.tableStart,d)}s.setSelection(new v(s.doc.resolve(l+r.tableStart))),t(s)}return!0}function splitCell(e,t){var n=tableNodeTypes(e.schema);return splitCellWithType((function(e){var t=e.node;return n[t.type.spec.tableRole]}))(e,t)}function splitCellWithType(e){return function(t,n){var r,o,l=t.selection;if(l instanceof v){if(l.$anchorCell.pos!=l.$headCell.pos)return!1;r=l.$anchorCell.nodeAfter,o=l.$anchorCell.pos}else{if(!(r=function cellWrapping(e){for(var t=e.depth;t>0;t--){var n=e.node(t).type.spec.tableRole;if("cell"===n||"header_cell"===n)return e.node(t)}return null}(l.$from)))return!1;o=cellAround(l.$from).pos}if(1==r.attrs.colspan&&1==r.attrs.rowspan)return!1;if(n){var a=r.attrs,i=[],s=a.colwidth;a.rowspan>1&&(a=setAttr(a,"rowspan",1)),a.colspan>1&&(a=setAttr(a,"colspan",1));for(var c,d=selectedRect(t),p=t.tr,u=0;u<d.right-d.left;u++)i.push(s?setAttr(a,"colwidth",s&&s[u]?[s[u]]:null):a);for(var f=d.top;f<d.bottom;f++){var h=d.map.positionAt(f,d.left,d.table);f==d.top&&(h+=r.nodeSize);for(var m=d.left,w=0;m<d.right;m++,w++)m==d.left&&f==d.top||p.insert(c=p.mapping.map(h+d.tableStart,1),e({node:r,row:f,col:m}).createAndFill(i[w]))}p.setNodeMarkup(o,e({node:r,row:d.top,col:d.left}),i[0]),l instanceof v&&p.setSelection(new v(p.doc.resolve(l.$anchorCell.pos),c&&p.doc.resolve(c))),n(p)}return!0}}function setCellAttr(e,t){return function(n,r){if(!isInTable(n))return!1;var o=selectionCell(n);if(o.nodeAfter.attrs[e]===t)return!1;if(r){var l=n.tr;n.selection instanceof v?n.selection.forEachCell((function(n,r){n.attrs[e]!==t&&l.setNodeMarkup(r,null,setAttr(n.attrs,e,t))})):l.setNodeMarkup(o.pos,null,setAttr(o.nodeAfter.attrs,e,t)),r(l)}return!0}}function isHeaderEnabledByType(e,t,n){for(var r=t.map.cellsInRect({left:0,top:0,right:"row"==e?t.map.width:1,bottom:"column"==e?t.map.height:1}),o=0;o<r.length;o++){var l=t.table.nodeAt(r[o]);if(l&&l.type!==n.header_cell)return!1}return!0}function toggleHeader(e,t){return(t=t||{useDeprecatedLogic:!1}).useDeprecatedLogic?function deprecated_toggleHeader(e){return function(t,n){if(!isInTable(t))return!1;if(n){for(var r=tableNodeTypes(t.schema),o=selectedRect(t),l=t.tr,a=o.map.cellsInRect("column"==e?new f(o.left,0,o.right,o.map.height):"row"==e?new f(0,o.top,o.map.width,o.bottom):o),i=a.map((function(e){return o.table.nodeAt(e)})),s=0;s<a.length;s++)i[s].type==r.header_cell&&l.setNodeMarkup(o.tableStart+a[s],r.cell,i[s].attrs);if(0==l.steps.length)for(var c=0;c<a.length;c++)l.setNodeMarkup(o.tableStart+a[c],r.header_cell,i[c].attrs);n(l)}return!0}}(e):function(t,n){if(!isInTable(t))return!1;if(n){var r=tableNodeTypes(t.schema),o=selectedRect(t),l=t.tr,a=isHeaderEnabledByType("row",o,r),i=isHeaderEnabledByType("column",o,r),s=("column"===e?a:"row"===e&&i)?1:0,c="column"==e?new f(0,s,1,o.map.height):"row"==e?new f(s,0,o.map.width,1):o,d="column"==e?i?r.cell:r.header_cell:"row"==e?a?r.cell:r.header_cell:r.cell;o.map.cellsInRect(c).forEach((function(e){var t=e+o.tableStart,n=l.doc.nodeAt(t);n&&l.setNodeMarkup(t,d,n.attrs)})),n(l)}return!0}}var b=toggleHeader("row",{useDeprecatedLogic:!0}),S=toggleHeader("column",{useDeprecatedLogic:!0}),y=toggleHeader("cell",{useDeprecatedLogic:!0});function goToNextCell(e){return function(t,n){if(!isInTable(t))return!1;var r=function findNextCell(e,t){if(t<0){var n=e.nodeBefore;if(n)return e.pos-n.nodeSize;for(var r=e.index(-1)-1,o=e.before();r>=0;r--){var l=e.node(-1).child(r);if(l.childCount)return o-1-l.lastChild.nodeSize;o-=l.nodeSize}}else{if(e.index()<e.parent.childCount-1)return e.pos+e.nodeAfter.nodeSize;for(var a=e.node(-1),i=e.indexAfter(-1),s=e.after();i<a.childCount;i++){var c=a.child(i);if(c.childCount)return s+1;s+=c.nodeSize}}}(selectionCell(t),e);if(null!=r){if(n){var o=t.doc.resolve(r);n(t.tr.setSelection(l.TextSelection.between(o,moveCellForward(o))).scrollIntoView())}return!0}}}function deleteTable(e,t){for(var n=e.selection.$anchor,r=n.depth;r>0;r--){if("table"==n.node(r).type.spec.tableRole)return t&&t(e.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0}return!1}var A=function TableView(e,t){this.node=e,this.cellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),updateColumns(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))};function updateColumns(e,t,n,r,o,l){for(var a=0,i=!0,s=t.firstChild,c=e.firstChild,d=0,p=0;d<c.childCount;d++)for(var u=c.child(d).attrs,f=u.colspan,h=u.colwidth,m=0;m<f;m++,p++){var v=o==p?l:h&&h[m],w=v?v+"px":"";a+=v||r,v||(i=!1),s?(s.style.width!=w&&(s.style.width=w),s=s.nextSibling):t.appendChild(document.createElement("col")).style.width=w}for(;s;){var g=s.nextSibling;s.parentNode.removeChild(s),s=g}i?(n.style.width=a+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=a+"px")}A.prototype.update=function update(e){return e.type==this.node.type&&(this.node=e,updateColumns(e,this.colgroup,this.table,this.cellMinWidth),!0)},A.prototype.ignoreMutation=function ignoreMutation(e){return"attributes"==e.type&&(e.target==this.table||this.colgroup.contains(e.target))};var R=new l.PluginKey("tableColumnResizing");function columnResizing(e){void 0===e&&(e={});var t=e.handleWidth;void 0===t&&(t=5);var n=e.cellMinWidth;void 0===n&&(n=25);var r=e.View;void 0===r&&(r=A);var o=e.lastColumnResizable;return void 0===o&&(o=!0),new l.Plugin({key:R,state:{init:function init(e,t){return this.spec.props.nodeViews[tableNodeTypes(t.schema).table.name]=function(e,t){return new r(e,n,t)},new T(-1,!1)},apply:function apply(e,t){return t.apply(e)}},props:{attributes:function attributes(e){return R.getState(e).activeHandle>-1?{class:"resize-cursor"}:null},handleDOMEvents:{mousemove:function mousemove(e,n){!function handleMouseMove(e,t,n,r,o){var l=R.getState(e.state);if(!l.dragging){var a=function domCellAround(e){for(;e&&"TD"!=e.nodeName&&"TH"!=e.nodeName;)e=e.classList.contains("ProseMirror")?null:e.parentNode;return e}(t.target),i=-1;if(a){var s=a.getBoundingClientRect(),c=s.left,d=s.right;t.clientX-c<=n?i=edgeCell(e,t,"left"):d-t.clientX<=n&&(i=edgeCell(e,t,"right"))}if(i!=l.activeHandle){if(!o&&-1!==i){var p=e.state.doc.resolve(i),u=p.node(-1),f=h.get(u),m=p.start(-1);if(f.colCount(p.pos-m)+p.nodeAfter.attrs.colspan-1==f.width-1)return}updateHandle(e,i)}}}(e,n,t,0,o)},mouseleave:function mouseleave(e){!function handleMouseLeave(e){var t=R.getState(e.state);t.activeHandle>-1&&!t.dragging&&updateHandle(e,-1)}(e)},mousedown:function mousedown(e,t){!function handleMouseDown$1(e,t,n){var r=R.getState(e.state);if(-1==r.activeHandle||r.dragging)return!1;var o=e.state.doc.nodeAt(r.activeHandle),l=function currentColWidth(e,t,n){var r=n.colspan,o=n.colwidth,l=o&&o[o.length-1];if(l)return l;var a=e.domAtPos(t),i=a.node.childNodes[a.offset].offsetWidth,s=r;if(o)for(var c=0;c<r;c++)o[c]&&(i-=o[c],s--);return i/s}(e,r.activeHandle,o.attrs);function finish(t){window.removeEventListener("mouseup",finish),window.removeEventListener("mousemove",move);var r=R.getState(e.state);r.dragging&&(!function updateColumnWidth(e,t,n){for(var r=e.state.doc.resolve(t),o=r.node(-1),l=h.get(o),a=r.start(-1),i=l.colCount(r.pos-a)+r.nodeAfter.attrs.colspan-1,s=e.state.tr,c=0;c<l.height;c++){var d=c*l.width+i;if(!c||l.map[d]!=l.map[d-l.width]){var p=l.map[d],u=o.nodeAt(p).attrs,f=1==u.colspan?0:i-l.colCount(p);if(!u.colwidth||u.colwidth[f]!=n){var m=u.colwidth?u.colwidth.slice():zeroes(u.colspan);m[f]=n,s.setNodeMarkup(a+p,null,setAttr(u,"colwidth",m))}}}s.docChanged&&e.dispatch(s)}(e,r.activeHandle,draggedWidth(r.dragging,t,n)),e.dispatch(e.state.tr.setMeta(R,{setDragging:null})))}function move(t){if(!t.which)return finish(t);var r=R.getState(e.state),o=draggedWidth(r.dragging,t,n);!function displayColumnWidth(e,t,n,r){var o=e.state.doc.resolve(t),l=o.node(-1),a=o.start(-1),i=h.get(l).colCount(o.pos-a)+o.nodeAfter.attrs.colspan-1,s=e.domAtPos(o.start(-1)).node;for(;"TABLE"!=s.nodeName;)s=s.parentNode;updateColumns(l,s.firstChild,s,r,i,n)}(e,r.activeHandle,o,n)}return e.dispatch(e.state.tr.setMeta(R,{setDragging:{startX:t.clientX,startWidth:l}})),window.addEventListener("mouseup",finish),window.addEventListener("mousemove",move),t.preventDefault(),!0}(e,t,n)}},decorations:function decorations(e){var t=R.getState(e);if(t.activeHandle>-1)return function handleDecorations(e,t){for(var n=[],r=e.doc.resolve(t),o=r.node(-1),l=h.get(o),a=r.start(-1),i=l.colCount(r.pos-a)+r.nodeAfter.attrs.colspan,c=0;c<l.height;c++){var d=i+c*l.width-1;if(!(i!=l.width&&l.map[d]==l.map[d+1]||0!=c&&l.map[d-1]==l.map[d-1-l.width])){var p=l.map[d],u=a+p+o.nodeAt(p).nodeSize-1,f=document.createElement("div");f.className="column-resize-handle",n.push(s.Decoration.widget(u,f))}}return s.DecorationSet.create(e.doc,n)}(e,t.activeHandle)},nodeViews:{}}})}var T=function ResizeState(e,t){this.activeHandle=e,this.dragging=t};function edgeCell(e,t,n){var r=e.posAtCoords({left:t.clientX,top:t.clientY}).pos,o=cellAround(e.state.doc.resolve(r));if(!o)return-1;if("right"==n)return o.pos;var l=h.get(o.node(-1)),a=o.start(-1),i=l.map.indexOf(o.pos-a);return i%l.width==0?-1:a+l.map[i-1]}function draggedWidth(e,t,n){var r=t.clientX-e.startX;return Math.max(n,e.startWidth+r)}function updateHandle(e,t){e.dispatch(e.state.tr.setMeta(R,{setHandle:t}))}function zeroes(e){for(var t=[],n=0;n<e;n++)t.push(0);return t}function tableEditing(e){void 0===e&&(e={});var t=e.allowTableNodeSelection;return void 0===t&&(t=!1),new l.Plugin({key:m,state:{init:function init(){return null},apply:function apply(e,t){var n=e.getMeta(m);if(null!=n)return-1==n?null:n;if(null==t||!e.docChanged)return t;var r=e.mapping.mapResult(t),o=r.deleted,l=r.pos;return o?null:l}},props:{decorations:drawCellSelection,handleDOMEvents:{mousedown:handleMouseDown},createSelectionBetween:function createSelectionBetween(e){if(null!=m.getState(e.state))return e.state.selection},handleTripleClick:handleTripleClick,handleKeyDown:g,handlePaste:handlePaste},appendTransaction:function appendTransaction(e,n,r){return function normalizeSelection(e,t,n){var r,o,a=(t||e).selection,i=(t||e).doc;if(a instanceof l.NodeSelection&&(o=a.node.type.spec.tableRole)){if("cell"==o||"header_cell"==o)r=v.create(i,a.from);else if("row"==o){var s=i.resolve(a.from+1);r=v.rowSelection(s,s)}else if(!n){var c=h.get(a.node),d=a.from+1,p=d+c.map[c.width*c.height-1];r=v.create(i,d+1,p)}}else a instanceof l.TextSelection&&function isCellBoundarySelection(e){var t=e.$from,n=e.$to;if(t.pos==n.pos||t.pos<t.pos-6)return!1;for(var r=t.pos,o=n.pos,l=t.depth;l>=0&&!(t.after(l+1)<t.end(l));l--,r++);for(var a=n.depth;a>=0&&!(n.before(a+1)>n.start(a));a--,o--);return r==o&&/row|table/.test(t.node(l).type.spec.tableRole)}(a)?r=l.TextSelection.create(i,a.from):a instanceof l.TextSelection&&function isTextSelectionAcrossCells(e){for(var t,n,r=e.$from,o=e.$to,l=r.depth;l>0;l--){var a=r.node(l);if("cell"===a.type.spec.tableRole||"header_cell"===a.type.spec.tableRole){t=a;break}}for(var i=o.depth;i>0;i--){var s=o.node(i);if("cell"===s.type.spec.tableRole||"header_cell"===s.type.spec.tableRole){n=s;break}}return t!==n&&0===o.parentOffset}(a)&&(r=l.TextSelection.create(i,a.$from.start(),a.$from.end()));return r&&(t||(t=e.tr)).setSelection(r),t}(r,fixTables(r,n),t)}})}T.prototype.apply=function apply(e){var t=this,n=e.getMeta(R);if(n&&null!=n.setHandle)return new T(n.setHandle,null);if(n&&void 0!==n.setDragging)return new T(t.activeHandle,n.setDragging);if(t.activeHandle>-1&&e.docChanged){var r=e.mapping.map(t.activeHandle,-1);pointsAtCell(e.doc.resolve(r))||(r=null),t=new T(r,t.dragging)}return t}}}]);